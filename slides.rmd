---
title: "Docker Containers"
subtitle: "CMIS 545 - Cloud Computing Architecture"
author: Rafael Marino, Eduardo Cassinelli
institute: McGill University
date: November, 2020
output: 
  beamer_presentation:
    theme: "Frankfurt"
    colortheme: "albatross"
    fonttheme: "structurebold"
    slide_level: 2
    toc: yes

---
  
# Just Enough Microservices
  
## What are Microservices?
- Microservices are a good starting point for containers  
- Microservices are self-contained, independent, autonomous, loosely coupled services that work together
- No standard definition, they are usually built around a business domain
- Designed specifically to allow independent deployability of each service

## How do Microservices relate to Containers?

- Containers facilitate the modularized development and deployment of microservices
- For this level of independence and flexibility to exist, a clear definition between service boundaries must also exist
- Having services tied to specific machines would be inefficient and risky 
- Using one container per service guarantees independence 

# Virtual Machines vs Containers

## Virtual Machines 
- Virtualization allows the creation of an abstraction layer (Hypervisor) on top of the host OS to divide and virtualize physical resources
- Resources from the host machine are carved out into multiple Virtual Machines
- Each VM runs an independent, guest OS 

## Containers
- Containerization is based on the creation of isolated partitions or zones directly from within the host OS, no virtualization software required
- Partitions only have access to their own content, and to specific shared OS Kernel components
- A container is a standard unit of software that can be deployed on any other machine, virtual or otherwise, that runs a compatible OS; independently of any other containers

## 
![Container vs VM Architecture]("images/vs.png")


# Docker & Docker Primitives

## What is Docker?
- Docker is an open source platform for developers and systems engineers to build, ship, and run distributed applications
- Docker can package code from an application, including all its dependencies, into a container

## Docker Engine

- The Docker Engine is the underlying software that acts as a client-server for building, executing and orchestrating containers
- It relies on 3 major components:
  - The Docker Daemon
  - The Docker Engine API
  - The Command Line Interface
  
## Docker Engine Diagram

![Docker Engine Diagram]("images/docker_engine.png"){width=80%}

## Docker Image
- We can think of a Docker Image as a stopped Docker Container
- Each element within an image represents an image layer. Layers are then stacked on top of each other and ready to run. 
- Docker Images can be pulled (downloaded) from image registries, which are collections of image repositories.

## Building a Docker Image
- Define the DockerFile
- The DockerFile declares the staring point of the image: From Scratch or From Parent Image
- It describes and contains all the layers
- The image can be built running the *docker build* command

## Docker Container
- A Docker Container is a runtime instance of a Docker Image
- It is possible to run many Containers (instances) from one Image
- Containers are the central unit on top of which all Docker is built, and they are better examined practically. 

## Docker Compose

# Docker Demo

## Graylog App
- Graylog is an open source log management solution for capturing, storing, and analyzing machine data
- It needs two dependencies:
  - MongoDB: An open-source, “general purpose, document-based, distributed database”
  - Elasticsearch: An open-source, “powerful analytics engine to explore data easily”

## Docker Run
*~$ docker container run \<options\> \<image\>:\<tag\> \<app\>* 

- \<options\>: refers to the container command flags
- \<image\>: refers to the original name or id of the image
- \<tag\>: refers to the specific version of that image

*~$ docker container run -d --name ubuntu ubuntu:latest*

## Graylog Setup

![Graylog Setup Commands]("images/installation.png")

### Note
In Ubuntu 20.04 LTS stock, installing graylog requires adjusting default virtual memory settings using: *sudo sysctl -w vm.max_map_count=262144*

## Running Containers
![Running Containers' List]("images/container_list.png")

## Testing Graylog

![Echo Command]("images/message.png"){width=70%}

![Graylog Dashboard]("images/graylog_dash.png"){width=90%}

## Stoping and Removing Containers

![Stoping Single Container]("images/mongo_stop.png")

![Stopping and Removing all Containers]("images/all_stop.png")


## Further Container Commands[1]

Command                   | Description 
--------------------------|----------------
*docker container prune*  | Remove all stopped containers
*docker container start*  | Start one or more stopped containers
*docker container diff*   | Inspect file or directory changes
*docker container exec*   | Run a command in a running container
*docker container export* | Export a container’s filesystem as a tar
*docker container inspect*| Display detailed information
*docker container kill*   | Kill one or more running containers
*docker container logs*   | Fetch the logs of a container

### [1]
Documentation: https://docs.docker.com/engine/reference/commandline/container_run/
